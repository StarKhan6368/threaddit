import{r as c,e as y,j as e,c as d,S as x,m as f,P as i,b as C,A as $,d as h,L as _,g as k}from"./index-f0e57c33.js";import{A as q,u as S}from"./index-dc1c0901.js";function T(){const[t,l]=c.useState(!1),{data:a}=y({queryKey:["inbox"],queryFn:async()=>await h.get("/api/messages/inbox").then(s=>s.data)});return e.jsxs("div",{className:"flex flex-1",children:[!t&&e.jsxs("ul",{className:"md:hidden p-4 m-2.5 space-y-2 list-none bg-white rounded-md w-full",children:[e.jsx("div",{className:"flex justify-between items-center py-3 border-b-2",children:e.jsx("h1",{className:"text-2xl font-semibold text-blue-600",children:"Messages"})}),a==null?void 0:a.map(s=>e.jsxs("li",{className:`w-full flex items-center p-3 space-x-2 rounded-xl cursor-pointer ${t.username===s.sender.username?"bg-blue-200":"hover:bg-blue-200"}`,onClick:()=>l(s.sender),children:[e.jsx("img",{src:s.sender.avatar||d,className:"w-14 h-14 rounded-full",alt:""}),e.jsxs("div",{className:"flex flex-col space-y-1 w-full",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("p",{className:"font-medium",children:s.sender.username}),!s.latest_from_user&&!s.seen&&e.jsx(x,{type:"mail",className:"w-4 h-4 text-theme-orange"})]}),e.jsxs("p",{className:"text-sm",children:[s.latest_from_user?"You: ":`${s.receiver.username}: `,s.content.slice(0,15),s.content.length>15?"...":""]})]})]},s.message_id))]}),e.jsxs("ul",{className:"hidden md:block p-4 w-1/5 m-2.5 space-y-2 list-none bg-white rounded-md",children:[e.jsx("div",{className:"flex justify-between items-center py-3 border-b-2",children:e.jsx("h1",{className:"text-2xl font-semibold text-blue-600",children:"Messages"})}),a==null?void 0:a.map((s,r)=>e.jsxs(f.li,{initial:{opacity:0,x:-100},animate:{opacity:1,x:0},transition:{duration:.25,delay:r*.25},className:`flex items-center w-full p-3 space-x-2 rounded-xl cursor-pointer ${t.username===s.sender.username?"bg-blue-200":"hover:bg-blue-200"}`,onClick:()=>l(s.sender),children:[e.jsx("img",{src:s.sender.avatar||d,className:"w-14 h-14 rounded-full",alt:""}),e.jsxs("div",{className:"flex flex-col space-y-1 w-full",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("p",{className:"font-medium",children:s.sender.username}),!s.latest_from_user&&!s.seen&&e.jsx(x,{type:"mail",className:"w-4 h-4 text-theme-orange"})]}),e.jsxs("p",{className:"text-sm",children:[s.latest_from_user?"You: ":`${s.receiver.username}: `,s.content.slice(0,15),s.content.length>15?"...":""]})]})]},s.message_id))]}),e.jsx(q,{children:t&&e.jsx("div",{className:`flex-1 m-2.5 bg-white rounded-md ${!t&&"flex justify-center items-center"}`,children:e.jsx(v,{sender:t,setCurChat:l})})})]})}v.propTypes={sender:i.shape({avatar:i.string,name:i.string,username:i.string}),setCurChat:i.func,newChat:i.bool};function v({sender:t,setCurChat:l,newChat:a=!1}){const s=c.useRef(null),r=C(),{user:N}=$(),[u,p]=c.useState(""),{data:o,isFetching:b}=y({queryKey:["chat",t.username],queryFn:async()=>await h.get(`/api/messages/all/${t.username}`).then(n=>n.data),enabled:t.username!==void 0}),{mutate:j}=S({mutationFn:async n=>await h.post("/api/messages",{content:n.message,receiver:n.sender.username}).then(m=>m.data),onSuccess:()=>{p(""),r.invalidateQueries({queryKey:["chat",t.username]}),r.invalidateQueries({queryKey:["inbox"]})}});c.useEffect(()=>{var n;(n=s.current)==null||n.scrollIntoView({behavior:"smooth"})},[b]);const g={hidden:{opacity:0,x:10},visible:{opacity:1,x:0}};return e.jsxs(f.div,{className:`flex flex-col justify-between w-full ${a&&"bg-white w-10/12 md:w-1/2"}`,variants:g,initial:"hidden",animate:"visible",transition:{duration:.25},exit:{opacity:0,x:10,transition:{duration:.1}},children:[e.jsxs("div",{className:"flex justify-between items-center p-3 mx-2 border-b-2",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:t.avatar||d,alt:"",className:"w-14 h-14 rounded-full"}),e.jsx(_,{to:`/u/${t.username}`,className:"text-xl font-semibold text-blue-500",children:t.username})]}),e.jsx("button",{onClick:()=>l(!1),className:"justify-self-end p-2 ml-auto text-white bg-blue-600 rounded-md",children:"Close"})]}),b?e.jsx("div",{className:`${a?"h-[20vh]":"md:h-[61vh] h-[70vh]"} flex justify-center items-center`,children:e.jsx(k,{forPosts:!0})}):e.jsxs("ul",{className:`p-3 space-y-3 rounded-md overflow-auto ${a?"h-[20vh]":"md:h-[61vh] h-[70vh]"}`,children:[o==null?void 0:o.map((n,m)=>e.jsx(w,{message:n,messageIndex:m,toUser:n.sender.username==N.username},n.message_id)),e.jsx("li",{className:"invisible",ref:s},"scrollToElement")]}),e.jsxs("form",{onSubmit:n=>{n.preventDefault(),j({message:u,sender:t})},className:"flex justify-between items-center p-4 w-full bg-blue-200",children:[e.jsx("input",{type:"text",className:"p-2 px-4 mx-3 w-full font-medium rounded-full focus:outline-none",placeholder:"Type a message",value:u,onChange:n=>p(n.target.value)}),e.jsx(x,{onClick:()=>j({message:u,sender:t}),type:"send",className:"w-8 h-8 text-white bg-inherit"})]})]})}w.propTypes={message:i.object,toUser:i.bool,messageIndex:i.number};function w({message:t,toUser:l,messageIndex:a}){const s=new Date(t.created_at);return e.jsxs(f.li,{initial:{opacity:0,x:l?100:-100},animate:{opacity:1,x:0},transition:{duration:.25,delay:a*.1},className:` pl-2 py-1 w-fit rounded-md ${t.seen?"bg-green-100":"bg-blue-100"} ${l?"ml-auto pr-2":"pr-10"}`,children:[e.jsx("p",{className:`break-all pt-1 font-medium ${l&&"pl-1"}`,children:t.content}),e.jsx("p",{className:`mt-0.5 text-xs font-light ${l&&"text-right"}`,children:s.toLocaleString()})]})}export{v as Chat,T as Inbox,T as default};
