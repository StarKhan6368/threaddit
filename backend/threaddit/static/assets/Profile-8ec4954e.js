import{P as v,b as N,A as p,r,f,j as e,c as h,d as u,a as C,e as k,M}from"./index-f0e57c33.js";import{I as P}from"./InfinitePosts-98111f14.js";import{Chat as S}from"./Inbox-af818672.js";import{A as _}from"./index-dc1c0901.js";import"./Post-3ad6e2f5.js";j.propTypes={setModal:v.func};function j({setModal:m}){const c=N(),{user:n}=p(),[a,l]=r.useState(n.bio),[s,d]=r.useState(""),[i,g]=r.useState("image"),[y,b]=r.useState("");async function x(t){t==null||t.preventDefault();const o=new FormData;o.append("bio",a),o.append("content_type",i),o.append("content_url",y),s&&o.append("avatar",s,s.name),await u.patch("/api/user",o,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{m(!1),c.invalidateQueries({queryKey:["user",n.username]})}).catch(w=>alert(`${w.message} check your fields`))}return r.useEffect(()=>(f.setFocused(!1),()=>f.setFocused(!0)),[]),e.jsxs("div",{className:"flex flex-col p-5 space-y-5 w-5/6 rounded-md min-h-3/6 md:w-3/4 md:h-4/6 md:p-10 bg-theme-cultured",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center p-4 space-y-3 bg-white rounded-xl md:flex-row md:space-y-0",children:[e.jsx("p",{children:"Updating Profile for"}),e.jsx("img",{src:n.avatar||h,className:"w-10 h-10 rounded-full md:w-14 md:h-14",alt:""}),e.jsx("p",{children:n.username})]}),e.jsxs("form",{className:"flex flex-col p-5 space-y-10 bg-white rounded-md",onSubmit:x,children:[e.jsxs("label",{htmlFor:"bio",className:"flex flex-col p-2 md:space-x-3 md:flex-row",children:[e.jsx("span",{className:"text-sm font-light",children:"Bio"}),e.jsx("input",{value:a,onChange:t=>l(t.target.value),type:"text",name:"bio",id:"bio",className:"w-full border-b border-gray-800 focus:outline-none"})]}),e.jsxs("label",{htmlFor:"media",className:"flex flex-col items-center space-y-3 md:space-y-0 md:space-x-5 md:flex-row",children:[e.jsxs("select",{className:"px-10 py-2 bg-white rounded-md border md:px-12",name:"type",id:"media_type",onChange:t=>g(t.target.value),children:[e.jsx("option",{value:"image",children:"Image"}),e.jsx("option",{value:"url",children:"URL"})]}),i==="image"?e.jsx("input",{onChange:t=>d(t.target.files[0]),type:"file",name:"file",accept:"image/*",id:"image",className:"w-full focus:outline-none"}):e.jsx("input",{type:"text",name:"media_url",id:"media_url",className:"p-2 w-full rounded-md border border-gray-800 focus:outline-none",onChange:t=>b(t.target.value)})]}),e.jsx("button",{onClick:x,className:"py-2 font-semibold text-white rounded-md bg-theme-orange active:scale-95",children:"Submit"})]})]})}function K(){const{logout:m,user:c}=p(),{username:n}=C(),[a,l]=r.useState(!1),{data:s,isFetching:d}=k({queryKey:["user",n],queryFn:async()=>await u.get(`/api/user/${n}`).then(i=>i.data)});return r.useEffect(()=>{switch(a){case"message":l(e.jsx(S,{sender:s,setCurChat:l,newChat:!0}));break;case"edit":l(e.jsx(j,{setModal:l}));break;case"delete":window.confirm("Are you sure you want to delete your account?")&&u.delete("/api/user").then(()=>m()),l(!1);break}},[a,s,n,m]),console.log(s),e.jsxs("div",{className:"flex flex-col flex-1 items-center p-2 w-full bg-theme-cultured",children:[e.jsx("div",{className:"flex flex-col items-center w-full bg-theme-cultured",children:e.jsxs("div",{className:"flex flex-col p-2 w-full bg-white rounded-md md:p-5",children:[!d&&s&&e.jsxs("div",{className:"flex flex-col flex-1 justify-between items-center p-2 w-full rounded-md md:flex-row md:rounded-full bg-theme-cultured",children:[e.jsx("img",{src:s.avatar||h,className:"w-24 h-24 bg-white rounded-full md:w-36 md:h-36",alt:""}),e.jsxs("div",{className:"flex flex-col flex-1 items-center w-full md:p-2",children:[e.jsxs("h1",{className:"mt-2 text-lg font-semibold md:m-0",children:["u/",s.username]}),e.jsx("p",{className:"my-4 w-11/12 text-sm text-center md:my-2 md:text-base",children:s==null?void 0:s.bio}),e.jsxs("div",{className:"flex justify-between items-center w-full md:w-11/12",children:[e.jsxs("p",{className:"text-xs md:text-sm",children:["Karma: ",s==null?void 0:s.karma.user_karma]}),e.jsxs("p",{className:"text-xs md:text-sm",children:["Cake Day On: ",new Date(s==null?void 0:s.registrationDate).toDateString()]})]})]})]}),e.jsxs("div",{className:"flex flex-col my-2 text-sm md:text-sm",children:[e.jsxs("div",{className:"flex justify-between space-x-2",children:[e.jsxs("p",{className:"",children:["Total Posts: ",s==null?void 0:s.karma.posts_count]}),e.jsxs("p",{className:"",children:["Posts Karma: ",s==null?void 0:s.karma.posts_karma]})]}),e.jsxs("div",{className:"flex justify-between space-x-2",children:[e.jsxs("p",{className:"",children:["Total Comments: ",s==null?void 0:s.karma.comments_count]}),e.jsxs("p",{className:"",children:["Comments Karma: ",s==null?void 0:s.karma.comments_karma]})]})]}),e.jsxs("select",{name:"options",id:"options",className:"p-2 mt-2 bg-white rounded-md border-2",value:a,onChange:i=>l(i.target.value),children:[e.jsx("option",{value:!1,children:"Choose an action"}),c.username===(s==null?void 0:s.username)&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"edit",children:"Update Profile"}),e.jsx("option",{value:"delete",children:"Delete Account"})]}),e.jsx("option",{value:"message",children:"Message"})]})]})}),e.jsx(P,{apiQueryKey:s==null?void 0:s.username,linkUrl:`posts/user/${s==null?void 0:s.username}`,enabled:(s==null?void 0:s.username)!==void 0}),e.jsx(_,{children:a!==!1&&a!=="delete"&&e.jsx(M,{showModal:a,setShowModal:l,children:a})})]})}export{K as Profile,K as default};
