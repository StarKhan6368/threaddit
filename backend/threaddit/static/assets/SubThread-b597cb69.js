import{P as b,r as u,e as y,d as c,f as j,j as s,S as g,g as v,u as M,b as $,a as S,A as C,M as k,N as L}from"./index-f0e57c33.js";import{I as F}from"./InfinitePosts-98111f14.js";import{u as w,A as P}from"./index-dc1c0901.js";import"./Post-3ad6e2f5.js";N.propTypes={mods:b.array,threadId:b.number};function N({mods:x,threadId:p}){const[l,i]=u.useState(x),[r,d]=u.useState(""),{data:o,isFetching:h}=y({queryKey:["search/user",r],queryFn:async({signal:e})=>await c.get(`/api/user/search/${r}`,{signal:e}).then(m=>m.data),enabled:r.length>3});u.useEffect(()=>(j.setFocused(!1),()=>j.setFocused(!0)),[]);const{mutate:a}=w({mutationFn:async({username:e,isDelete:m=!1})=>m?await c.delete(`/api/thread/mod/${p}/${e}`).then(n=>(i(l.filter(t=>t!==e)),n.data)).catch(n=>{alert(`${n.message} - ${n.response.data.message}, Only admins can remove thread creator`)}):await c.put(`/api/thread/mod/${p}/${e}`).then(n=>(i([...l,e]),n.data))});return s.jsxs("div",{className:"w-5/6 h-5/6 bg-white rounded-md",children:[s.jsx("h1",{className:"pt-2 text-2xl font-semibold text-center text-theme-orange",children:"ModList"}),s.jsx("ul",{className:"overflow-auto relative p-3 m-3 space-y-2 max-h-[40vh] list-none bg-theme-cultured",children:l.map(e=>s.jsxs("li",{className:"flex justify-between items-center p-1 bg-white rounded-md cursor-pointer",onClick:()=>a({username:e,isDelete:!0}),children:[e,s.jsx(g,{type:"delete",className:"w-8 h-8 font-bold text-theme-orange"})]},e))}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("input",{type:"text",name:"username",id:"username",value:r,onChange:e=>d(e.target.value),className:"p-2 mx-3 font-semibold border-2 md:mx-10",placeholder:"Enter username to add new mod"}),h?s.jsx("div",{className:"m-28",children:s.jsx(v,{forPosts:!0})}):o&&s.jsx("ul",{className:"overflow-auto relative p-4 m-3 space-y-2 md:max-h-[38vh] max-h-[45vh] list-none rounded-md bg-theme-cultured",children:o==null?void 0:o.map(e=>!l.includes(e.username)&&s.jsxs("li",{className:"flex justify-between items-center p-1 px-2 bg-white rounded-md cursor-pointer",onClick:()=>a({username:e.username}),children:[e.username,s.jsx(g,{type:"add",className:"w-8 h-8 font-bold text-theme-orange"})]},e.username))})]})]})}function I(){const x=u.useRef(),p=M(),[l,i]=u.useState(!1),r=$(),d=S(),{isAuthenticated:o,user:h}=C(),{data:a}=y({queryKey:["thread",d.threadName],queryFn:async()=>await c.get(`/api/threads/${d.threadName}`).then(t=>t.data)}),e=a==null?void 0:a.threadData,{mutate:m}=w({mutationFn:async t=>t?await c.delete(`/api/threads/subscription/${e.id}`).then(f=>f.data):await c.post(`/api/threads/subscription/${e.id}`).then(f=>f.data),onSuccess:()=>r.invalidateQueries({queryKey:["thread",d.threadName]})});function n(t){switch(t){case"more":break;case"edit":i(s.jsx(L,{ogInfo:e,edit:!0,setShowModal:i}));break;case"manage-mods":i(s.jsx(N,{mods:e.modList||[],threadId:e.id}));break;default:p(`/u/${t}`)}x.current.value="more"}return s.jsxs("div",{className:"flex flex-col flex-1 items-center p-2 w-full bg-theme-cultured",children:[s.jsxs("div",{className:"flex flex-col p-5 space-y-1 w-full bg-white rounded-md md:pb-3 md:space-y-3",children:[s.jsxs("div",{className:`flex p-2 flex-col md:flex-row items-center rounded-md md:rounded-full bg-theme-cultured ${!(e!=null&&e.logo)&&"py-5"}`,children:[(e==null?void 0:e.logo)&&s.jsx("img",{src:e==null?void 0:e.logo,className:"w-32 h-32 rounded-full md:w-36 md:h-36",alt:""}),s.jsxs("div",{className:"flex flex-col flex-1 justify-around items-center p-2 space-y-1",children:[s.jsx("div",{className:"flex items-center space-x-5",children:s.jsx("h1",{className:"text-xl font-semibold",children:e==null?void 0:e.name})}),s.jsxs("p",{className:"text-xs",children:["Since: ",new Date(e==null?void 0:e.created_at).toDateString()]}),(e==null?void 0:e.description)&&s.jsx("p",{className:`${(e==null?void 0:e.description.length)>90&&"text-xs"} md:block`,children:e==null?void 0:e.description}),s.jsxs("div",{className:"flex justify-between mt-2 space-x-7 w-full md:w-11/12",children:[s.jsxs("p",{className:"text-sm",children:[e==null?void 0:e.subscriberCount," subscribers"]}),s.jsxs("p",{className:"text-sm",children:[e==null?void 0:e.PostsCount," posts"]}),s.jsxs("p",{className:"text-sm",children:[e==null?void 0:e.CommentsCount," comments"]})]})]})]}),o&&s.jsxs("div",{className:"flex flex-col justify-around space-y-3 md:space-x-10 md:flex-row md:space-y-0",children:[s.jsx("button",{className:`px-32 py-2 text-white rounded-full active:scale-90 ${e!=null&&e.has_subscribed?"bg-blue-400":"bg-theme-red-coral"} `,onClick:()=>m(e==null?void 0:e.has_subscribed),children:e!=null&&e.has_subscribed?"Leave":"Join"}),s.jsxs("select",{ref:x,defaultValue:"more",onChange:t=>n(t.target.value),name:"mods",id:"mods",className:"px-10 py-2 text-center rounded-md md:block bg-theme-cultured",children:[s.jsx("option",{value:"more",children:"More"}),o&&(h.mod_in.includes(e==null?void 0:e.id)||h.roles.includes("admin"))&&s.jsxs("optgroup",{label:"Subthread Options",children:[s.jsx("option",{value:"edit",children:"Edit Subthread"}),s.jsx("option",{value:"manage-mods",children:"Manage Mods"})]}),s.jsx("optgroup",{label:"ModList",children:e==null?void 0:e.modList.map(t=>s.jsx("option",{value:t,children:t},t))})]})]})]}),s.jsx(F,{apiQueryKey:e==null?void 0:e.name,linkUrl:`posts/thread/${e==null?void 0:e.id}`,enabled:e!==void 0}),s.jsx(P,{children:l&&s.jsx(k,{setShowModal:i,children:l})})]})}export{I as SubThread,I as default};
