import{P as t,A as g,r as v,b as p,q as F,u as M,s as A,j as a,S as y,d as N,t as T,a as q,c as S,m as E,L as _,v as Q,M as V}from"./index-51f78cb4.js";import{u as K,A as L}from"./index-e81b643c.js";C.propTypes={creatorInfo:t.object,threadInfo:t.object,postInfo:t.object,setShowModal:t.func,setModalData:t.func,handleShare:t.func};function C({creatorInfo:e,threadInfo:n,postInfo:l,setShowModal:u,setModalData:f,handleShare:s}){const{isAuthenticated:h,user:r}=g(),[x,m]=v.useState(l==null?void 0:l.saved),c=p(),j=F(),i=M(),d=v.useRef(),[b,o]=v.useState(!1);A(d,()=>{o(!1)});async function $(){if(h){if(await N.delete(`/api/post/${l==null?void 0:l.id}`),j.pathname.includes("post"))return i(-1);c.invalidateQueries({queryKey:["posts"]})}else alert("You must be logged in to delete.");o(!1)}async function P(){x?(await N.delete(`/api/posts/saved/${l==null?void 0:l.id}`),m(!1)):(await N.put(`/api/posts/saved/${l==null?void 0:l.id}`),m(!0)),c.invalidateQueries({queryKey:["saved"]}),o(!1)}function R(){u(!0),f(a.jsx(T,{isEdit:!0,postInfo:l,setShowModal:u,threadInfo:n}))}const D=h&&(e.user_name===r.username||r.roles.includes("admin")||r.roles.includes("mod")&&r.mod_in.includes(n.thread_id));return a.jsx(a.Fragment,{children:a.jsxs("div",{ref:d,className:"flex relative items-center cursor-pointer group",onClick:()=>o(!0),children:[a.jsx(y,{className:"w-4 h-4 md:w-6 md:h-6",type:"more"}),a.jsx("p",{className:"ml-2 text-sm cursor-pointer md:text-base",children:"More"}),b&&a.jsxs("ul",{className:"absolute top-full z-10 p-1 mt-1 space-y-1 w-24 list-none bg-white rounded-md border-2 border-theme-cultured",children:[a.jsx("li",{className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",onClick:P,children:x?"Unsave":"Save"}),D&&a.jsx("li",{className:"p-1 text-sm text-red-500 cursor-pointer md:text-base hover:bg-theme-cultured",onClick:$,children:"Delete"}),e.user_name===r.username&&a.jsx("li",{onClick:R,className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",children:"Edit"}),a.jsx("li",{className:"p-1 text-sm cursor-pointer md:hidden md:text-base hover:bg-theme-cultured",onClick:()=>{s().then(()=>o(!1))},children:"Share"})]})]})})}k.propTypes={parentComment:t.object,isComment:t.bool,setShowModal:t.func,edit:t.bool};function k({parentComment:e,isComment:n=!1,setShowModal:l,edit:u=!1}){const f=p(),{postId:s}=q(),[h,r]=v.useState("");async function x(m){if(m==null||m.preventDefault(),u)return N.patch(`/api/comments/${e.comment_info.id}`,{content:h}).then(()=>{l(!1),f.invalidateQueries({queryKey:["post/comment",s]})});const c=new FormData;c.append("content",h),n&&(c.append("has_parent",!0),c.append("parent_id",e.comment_info.id)),c.append("post_id",s),await N.post("/api/comments",c,{headers:{"Content-Type":"application/json"}}).then(()=>{l(!1),f.invalidateQueries({queryKey:["post/comment",s]})})}return a.jsxs("div",{className:"flex flex-col justify-between p-5 w-5/6 bg-white rounded-md min-h-4/6 md:w-2/6",children:[a.jsxs("div",{className:"p-4 mx-auto space-y-3 w-full rouned-md",children:[a.jsxs("div",{className:"flex justify-center items-center p-2 space-x-5 w-full rounded-md border-2",children:[a.jsx("img",{src:e.user_info.user_avatar||S,className:"w-10 h-10 rounded-full",alt:""}),a.jsx("p",{children:e.user_info.user_name})]}),a.jsxs("div",{className:"p-2",children:[a.jsxs("p",{className:"ml-2 text-sm italic",children:["On ",n?"comment":"post"," said"]}),a.jsx("p",{className:"p-2 font-medium",children:n?e.comment_info.content:e.post_info.title})]})]}),a.jsxs("form",{className:"flex-1 px-5 space-y-5",onSubmit:x,children:[a.jsxs("label",{htmlFor:"content",className:"flex flex-col space-y-1",children:[a.jsx("span",{className:"ml-2 text-sm font-semibold",children:u?"Edit to":"Reply"}),a.jsx("input",{autoFocus:!0,type:"text",className:"p-2 mx-2 rounded-md border-2 focus:outline-none",value:h,onChange:m=>r(m.target.value)})]}),a.jsx("button",{onClick:x,className:"px-12 py-2 w-full font-semibold text-white rounded-md bg-theme-orange active:scale-95",children:"Submit"})]})]})}w.propTypes={url:t.string,initialCount:t.number,intitalVote:t.bool,contentID:t.number,type:t.string};function w({url:e,intitalVote:n,initialCount:l,contentID:u,type:f}){const[s,h]=v.useState(n),[r,x]=v.useState(l),{isAuthenticated:m}=g(),{mutate:c}=K({mutationFn:async({vote:i,method:d,contentID:b})=>{switch(d){case"put":return N.put(`${e}/${b}`,{is_upvote:i}).then(o=>o.data);case"patch":return N.patch(`${e}/${b}`,{is_upvote:i}).then(o=>o.data);case"delete":return N.delete(`${e}/${b}`).then(o=>o.data)}}});function j(i){if(!m)return alert("You must be logged in to vote.");s===null?(c({vote:i,method:"put",contentID:u}),x(d=>d+(i?1:-1))):i===null?(c({vote:i,method:"delete",contentID:u}),x(d=>d-(s?1:-1))):(c({vote:i,method:"patch",contentID:u}),x(d=>d+(i?2:-2))),h(i)}return f==="mobile"?a.jsxs(a.Fragment,{children:[a.jsx(y,{type:"mobileVote",className:"w-5 h-5 md:w-6 md:h-6",defaultStyle:!0,active:s===!0,onClick:()=>j(s?null:!0)}),a.jsx("p",{className:s===!0?"text-theme-red-coral":s===!1?"text-sky-600":"",children:r}),a.jsx(y,{type:"mobileVote",className:"w-5 h-5 rotate-180 md:w-6 md:h-6",defaultStyle:!1,active:s===!1,onClick:()=>j(s===!1?null:!1)})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-5 py-0.5 bg-orange-100 rounded-md",children:a.jsx(y,{type:"down-arrow",defaultStyle:!0,className:"w-10 h-10 rotate-180",onClick:()=>j(s?null:!0),active:s===!0})}),a.jsx("p",{className:"text-lg font-semibold",children:a.jsx("span",{className:s===!0?"text-theme-red-coral":s===!1?"text-sky-600":"",children:r})}),a.jsx("div",{className:"px-5 py-0.5 bg-blue-50 rounded-md group",children:a.jsx(y,{type:"down-arrow",className:"w-10 h-10",defaultStyle:!1,onClick:()=>j(s===!1?null:!1),active:s===!1})})]})}O.propTypes={post:t.object,isExpanded:t.bool,postIndex:t.number};function O({post:e,isExpanded:n=!1,postIndex:l}){var i,d;const{isAuthenticated:u}=g(),[f,s]=v.useState(!1),[h,r]=v.useState(a.jsx(a.Fragment,{}));function x(){e!=null&&e.post_info.media&&(s(!0),r(a.jsx("img",{className:"w-11/12 max-h-5/6 md:w-max md:max-h-screen md:max-w-screen",src:e==null?void 0:e.post_info.media,alt:""})))}function m(){u?(s(!0),r(a.jsx(k,{className:"w-5/6 h-5/6",parentComment:e,setShowModal:s}))):alert("You must be logged in to reply.")}const c={hidden:{opacity:0,y:100},animate:{opacity:1,y:0},empty:{}};async function j(){return navigator.clipboard.writeText(location.href).then(()=>{alert("Copied Post Link to clipboard")}).catch(b=>alert(b))}return a.jsxs(a.Fragment,{children:[a.jsxs(E.div,{className:"flex flex-col p-1 pb-3 bg-white rounded-xl border-2 md:pb-0 hover:drop-shadow-md md:flex-row border-theme-gray-blue",variants:c,initial:l<5||n?"hidden":"empty",animate:l<5||n?"animate":"empty",exit:{opacity:0,y:100,transition:{duration:.25}},transition:{duration:.25,delay:l*.25},children:[a.jsxs("div",{className:"flex flex-col flex-1 p-3 space-y-5 w-full md:space-y-0 md:space-x-4 md:flex-row",children:[(e==null?void 0:e.post_info.media)&&a.jsx("img",{onClick:()=>x(),src:e==null?void 0:e.post_info.media,alt:"",className:"rounded-md duration-500 cursor-pointer md:h-32 md:w-32 hover:scale-110"}),a.jsxs("div",{className:"flex flex-col justify-between space-y-2 w-full cursor-pointer",children:[a.jsxs(_,{className:"flex flex-col space-y-2 w-full h-full",to:`/post/${e==null?void 0:e.post_info.id}`,children:[a.jsx("div",{className:"w-full text-sm font-semibold md:text-lg text-ellipsis",children:e==null?void 0:e.post_info.title}),n&&a.jsx("p",{className:"text-sm",children:e==null?void 0:e.post_info.content})]}),a.jsxs("div",{className:"flex justify-between w-full md:space-x-2",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm",children:[a.jsxs(_,{to:`/u/${e==null?void 0:e.user_info.user_name}`,children:["By ",a.jsxs("span",{className:"font-medium",children:["u/",e==null?void 0:e.user_info.user_name]})]}),a.jsx("img",{src:(e==null?void 0:e.user_info.user_avatar)||S,alt:"",className:"w-5 h-5 rounded-full"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-xs md:text-sm",children:"in"}),a.jsx(_,{className:"text-xs font-medium md:text-sm",to:`/${e==null?void 0:e.thread_info.thread_name}`,children:` ${e==null?void 0:e.thread_info.thread_name}`}),(e==null?void 0:e.thread_info.thread_logo)&&a.jsx("img",{src:e==null?void 0:e.thread_info.thread_logo,alt:"",className:"w-5 h-5 rounded-full"})]})]}),a.jsxs("div",{className:"hidden space-x-1 md:flex",children:[a.jsx("p",{className:"text-xs font-light",children:e==null?void 0:e.post_info.created_at}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]}),a.jsxs("div",{className:"flex space-x-1 md:hidden",children:[a.jsx("p",{className:"text-xs font-light",children:e==null?void 0:e.post_info.created_at}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]})]}),a.jsxs("div",{className:"flex justify-around w-full md:justify-evenly md:px-10 md:flex-col md:w-fit",children:[n?a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(y,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6",onClick:()=>m()}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Reply"})]}):a.jsxs(_,{to:`/post/${e==null?void 0:e.post_info.id}`,className:"flex items-center space-x-2 cursor-pointer group",children:[a.jsx(y,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("span",{className:"text-sm cursor-pointer md:text-base",children:e==null?void 0:e.post_info.comments_count}),a.jsx("p",{className:"hidden md:block",children:"Comments"})]})]}),a.jsxs("div",{className:"hidden items-center space-x-2 cursor-pointer md:flex group",onClick:j,children:[a.jsx(y,{type:"share",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Share"})]}),a.jsx(C,{creatorInfo:e==null?void 0:e.user_info,threadInfo:e==null?void 0:e.thread_info,postInfo:e==null?void 0:e.post_info,setShowModal:s,setModalData:r,handleShare:j}),a.jsx("div",{className:"flex items-center space-x-3 md:hidden",children:a.jsx(w,{intitalVote:(i=e==null?void 0:e.current_user)==null?void 0:i.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"mobile"})})]}),a.jsx("div",{className:"hidden flex-col justify-around items-center my-2 space-y-1 w-28 border-l md:flex border-theme-gray-blue",children:a.jsx(w,{intitalVote:(d=e==null?void 0:e.current_user)==null?void 0:d.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"full"})})]}),n&&a.jsx(Q,{}),a.jsx(L,{children:f&&a.jsx(V,{setShowModal:s,showModal:f,children:h})})]})}export{O as P,k as R,w as V};
