import{P as j,r as u,e as w,d,f as g,g as N,j as s,S as y,L as v,u as $,b as S,a as C,A as L,M as k,N as F}from"./index-77e9b10b.js";import{I as P}from"./InfinitePosts-f965be50.js";import{A as q}from"./index-61dd66ac.js";import"./Post-ffc8e4e3.js";M.propTypes={mods:j.array,threadId:j.number};function M({mods:x,threadId:p}){const[i,o]=u.useState(x),[c,m]=u.useState(""),{data:r,isFetching:h}=w({queryKey:["search/user",c],queryFn:async({signal:t})=>await d.get(`/api/user/search/${c}`,{signal:t}).then(e=>e.data),enabled:c.length>3});u.useEffect(()=>(g.setFocused(!1),()=>g.setFocused(!0)),[]);const{mutate:a}=N({mutationFn:async({username:t,isDelete:e=!1})=>e?await d.delete(`/api/thread/mod/${p}/${t}`).then(l=>(o(i.filter(f=>f!==t)),l.data)).catch(l=>{alert(`${l.message} - ${l.response.data.message}, Only admins can remove thread creator`)}):await d.put(`/api/thread/mod/${p}/${t}`).then(l=>(o([...i,t]),l.data))});return s.jsxs("div",{className:"w-5/6 h-5/6 bg-white rounded-md",children:[s.jsx("h1",{className:"pt-2 text-2xl font-semibold text-center text-theme-orange",children:"ModList"}),s.jsx("ul",{className:"overflow-auto relative p-3 m-3 space-y-2 max-h-[40vh] list-none bg-theme-cultured",children:i.map(t=>s.jsxs("li",{className:"flex justify-between items-center p-1 bg-white rounded-md cursor-pointer",onClick:()=>a({username:t,isDelete:!0}),children:[t,s.jsx(y,{type:"delete",className:"w-8 h-8 font-bold text-theme-orange"})]},t))}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("input",{type:"text",name:"username",id:"username",value:c,onChange:t=>m(t.target.value),className:"p-2 mx-3 font-semibold border-2 md:mx-10",placeholder:"Enter username to add new mod"}),h?s.jsx("div",{className:"m-28",children:s.jsx(v,{forPosts:!0})}):r&&s.jsx("ul",{className:"overflow-auto relative p-4 m-3 space-y-2 md:max-h-[38vh] max-h-[45vh] list-none rounded-md bg-theme-cultured",children:r==null?void 0:r.map(t=>!i.includes(t.username)&&s.jsxs("li",{className:"flex justify-between items-center p-1 px-2 bg-white rounded-md cursor-pointer",onClick:()=>a({username:t.username}),children:[t.username,s.jsx(y,{type:"add",className:"w-8 h-8 font-bold text-theme-orange"})]},t.username))})]})]})}function K(){const x=u.useRef(),p=$(),[i,o]=u.useState(!1),c=S(),m=C(),{isAuthenticated:r,user:h}=L(),{data:a,isFetching:t}=w({queryKey:["thread",m.threadName],queryFn:async()=>await d.get(`/api/threads/${m.threadName}`).then(n=>n.data)}),e=a==null?void 0:a.threadData,{mutate:l}=N({mutationFn:async n=>n?await d.delete(`/api/threads/subscription/${e.id}`).then(b=>b.data):await d.post(`/api/threads/subscription/${e.id}`).then(b=>b.data),onSuccess:()=>c.invalidateQueries({queryKey:["thread",m.threadName]})});function f(n){switch(n){case"more":break;case"edit":o(s.jsx(F,{ogInfo:e,edit:!0,setShowModal:o}));break;case"manage-mods":o(s.jsx(M,{mods:e.modList||[],threadId:e.id}));break;default:p(`/u/${n}`)}x.current.value="more"}return s.jsxs("div",{className:"flex flex-col flex-1 items-center p-2 w-full bg-theme-cultured",children:[s.jsxs("div",{className:"flex flex-col p-5 space-y-1 w-full bg-white rounded-md md:pb-3 md:space-y-3",children:[t?s.jsx(v,{forPosts:!0}):s.jsxs("div",{className:`flex p-2 flex-col md:flex-row items-center rounded-md md:rounded-full bg-theme-cultured ${!(e!=null&&e.logo)&&"py-5"}`,children:[(e==null?void 0:e.logo)&&s.jsx("img",{src:e==null?void 0:e.logo,className:"w-32 h-32 rounded-full md:w-36 md:h-36",alt:""}),s.jsxs("div",{className:"flex flex-col flex-1 justify-around items-center p-2 space-y-1",children:[s.jsx("div",{className:"flex items-center space-x-5",children:s.jsx("h1",{className:"text-xl font-semibold",children:e==null?void 0:e.name})}),s.jsxs("p",{className:"text-xs",children:["Since: ",new Date(e==null?void 0:e.created_at).toDateString()]}),(e==null?void 0:e.description)&&s.jsxs("p",{className:`text-center py-4 md:py-2 text-sm ${(e==null?void 0:e.description.length)>90&&"text-xs"}`,children:[e==null?void 0:e.description,(e==null?void 0:e.description.length)>90&&"..."]}),s.jsxs("div",{className:"flex justify-between mt-2 space-x-7 w-full md:w-11/12",children:[s.jsxs("p",{className:"text-sm",children:[e==null?void 0:e.subscriberCount," subscribers"]}),s.jsxs("p",{className:"text-sm",children:[e==null?void 0:e.PostsCount," posts"]}),s.jsxs("p",{className:"text-sm",children:[e==null?void 0:e.CommentsCount," comments"]})]})]})]}),r&&s.jsxs("div",{className:"flex flex-col justify-around space-y-3 md:space-x-10 md:flex-row md:space-y-0",children:[s.jsx("button",{className:`px-32 py-2 text-white rounded-full active:scale-90 ${e!=null&&e.has_subscribed?"bg-blue-400":"bg-theme-red-coral"} `,onClick:()=>l(e==null?void 0:e.has_subscribed),children:e!=null&&e.has_subscribed?"Leave":"Join"}),s.jsxs("select",{ref:x,defaultValue:"more",onChange:n=>f(n.target.value),name:"mods",id:"mods",className:"px-10 py-2 text-center rounded-md md:block bg-theme-cultured",children:[s.jsx("option",{value:"more",children:"More"}),r&&(h.mod_in.includes(e==null?void 0:e.id)||h.roles.includes("admin"))&&s.jsxs("optgroup",{label:"Subthread Options",children:[s.jsx("option",{value:"edit",children:"Edit Subthread"}),s.jsx("option",{value:"manage-mods",children:"Manage Mods"})]}),s.jsx("optgroup",{label:"ModList",children:e==null?void 0:e.modList.map(n=>s.jsx("option",{value:n,children:n},n))})]})]})]}),s.jsx(P,{apiQueryKey:e==null?void 0:e.name,linkUrl:`posts/thread/${e==null?void 0:e.id}`,enabled:e!==void 0}),s.jsx(q,{children:i&&s.jsx(k,{setShowModal:o,children:i})})]})}export{K as SubThread,K as default};
