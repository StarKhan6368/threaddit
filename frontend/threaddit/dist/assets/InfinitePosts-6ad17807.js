import{Q as j,k as y,l as N,n as w,o as $,q as k,s as M,r as C,j as e,L as Q,g as O,P as b,d as R}from"./index-d818f154.js";import{P as T}from"./Post-799d4f99.js";class _ extends j{constructor(s,r){super(s,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s,r){super.setOptions({...s,behavior:y()},r)}getOptimisticResult(s){return s.behavior=y(),super.getOptimisticResult(s)}fetchNextPage({pageParam:s,...r}={}){return this.fetch({...r,meta:{fetchMore:{direction:"forward",pageParam:s}}})}fetchPreviousPage({pageParam:s,...r}={}){return this.fetch({...r,meta:{fetchMore:{direction:"backward",pageParam:s}}})}createResult(s,r){var d,l,m,i,a,u;const{state:n}=s,g=super.createResult(s,r),{isFetching:x,isRefetching:c}=g,h=x&&((d=n.fetchMeta)==null||(l=d.fetchMore)==null?void 0:l.direction)==="forward",t=x&&((m=n.fetchMeta)==null||(i=m.fetchMore)==null?void 0:i.direction)==="backward";return{...g,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:N(r,(a=n.data)==null?void 0:a.pages),hasPreviousPage:w(r,(u=n.data)==null?void 0:u.pages),isFetchingNextPage:h,isFetchingPreviousPage:t,isRefetching:c&&!h&&!t}}}function B(p,s,r){const d=$(p,s,r);return k(d,_)}E.propTypes={linkUrl:b.string,apiQueryKey:b.string,forSaved:b.bool,enabled:b.bool};function E({linkUrl:p,apiQueryKey:s,forSaved:r=!1,enabled:d=!0}){const[l,m]=M(),i=l.get("sortBy")||"top",a=l.get("duration")||"alltime",{data:u,isFetching:n,hasNextPage:g,fetchNextPage:x}=B({queryKey:["posts",s,i,a],queryFn:async({pageParam:t=0})=>await R.get(`/api/${p}?limit=20&offset=${t*20}&sortby=${i}&duration=${a}`).then(o=>o.data),enabled:d,getNextPageParam:(t,o)=>{if(!(t.length<20))return o.length}});C.useEffect(()=>{const t=o=>{const{scrollTop:f,scrollHeight:v,clientHeight:P}=o.target.scrollingElement;v-f<=P*2&&g&&!n&&x()};return window.addEventListener("scroll",t),()=>{window.removeEventListener("scroll",t)}},[x,n,g]);function c(t){l.set("duration",t),m(l)}function h(t){l.set("sortBy",t),m(l)}return e.jsxs("div",{id:"main-content",className:"flex flex-col flex-1 p-2 space-y-3 w-full h-full rounded-lg m-0.5 bg-theme-cultured md:bg-white md:m-3",children:[!r&&e.jsxs("header",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:hidden",children:[e.jsx("span",{children:"Sort by"}),e.jsxs("select",{name:"sort",id:"sort",className:"p-2 px-4 bg-white rounded-md md:bg-theme-cultured",onChange:t=>h(t.target.value),value:i,children:[e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"hot",children:"Hot"}),e.jsx("option",{value:"new",children:"New"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:hidden",children:[e.jsx("span",{children:"Of"}),e.jsxs("select",{name:"duration",id:"duration",className:"p-2 px-4 bg-white rounded-md md:bg-theme-cultured",onChange:t=>c(t.target.value),value:a,children:[e.jsx("option",{value:"day",children:"Day"}),e.jsx("option",{value:"week",children:"Week"}),e.jsx("option",{value:"month",children:"Month"}),e.jsx("option",{value:"year",children:"Year"}),e.jsx("option",{value:"alltime",children:"All Time"})]})]}),e.jsxs("ul",{className:"hidden space-x-2 list-none md:flex",children:[e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${a==="day"&&"bg-theme-gray-blue"}`,onClick:()=>c("day"),children:"Today"}),e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${a==="week"&&"bg-theme-gray-blue"}`,onClick:()=>c("week"),children:"Week"}),e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${a==="month"&&"bg-theme-gray-blue"}`,onClick:()=>c("month"),children:"Month"}),e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${a==="alltime"&&"bg-theme-gray-blue"}`,onClick:()=>c("alltime"),children:"All"})]}),e.jsxs("ul",{className:"hidden mr-5 space-x-5 list-none md:flex",children:[e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${i==="hot"&&"bg-theme-gray-blue"}`,onClick:()=>h("hot"),children:"Hot"}),e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${i==="new"&&"bg-theme-gray-blue"}`,onClick:()=>h("new"),children:"New"}),e.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${i==="top"&&"bg-theme-gray-blue"}`,onClick:()=>h("top"),children:"Top"})]})]}),n&&e.jsx(Q,{forPosts:!0}),e.jsx("div",{className:"flex flex-col flex-1 space-y-2 w-full h-full md:space-y-3",children:u==null?void 0:u.pages.map((t,o)=>e.jsx("ul",{className:"flex flex-col flex-1 space-y-2 w-full h-full md:space-y-3",children:e.jsx(O,{initial:o==0,children:t==null?void 0:t.map((f,v)=>e.jsx(T,{post:f,postIndex:v},f.post_info.id))})},o))})]})}export{E as I};
