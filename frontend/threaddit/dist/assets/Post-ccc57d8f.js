import{P as t,A as S,r as y,b as A,t as T,u as k,v as F,j as a,S as j,d as _,w as R,h as L,m as V,i as w,c as Y,x as q,g as E,M as Q}from"./index-4fc24ff5.js";$.propTypes={creatorInfo:t.object,threadInfo:t.object,currentUser:t.object,postInfo:t.object,setShowModal:t.func,setModalData:t.func,handleShare:t.func};function $({creatorInfo:e,threadInfo:n,currentUser:x,postInfo:i,setShowModal:b,setModalData:l,handleShare:N}){const{isAuthenticated:m,user:d}=S(),[v,o]=y.useState(x==null?void 0:x.saved),h=A(),s=T(),r=k(),c=y.useRef(),[u,f]=y.useState(!1);F(c,()=>{f(!1)});async function g(){if(m){if(await _.delete(`/api/post/${i==null?void 0:i.id}`),s.pathname.includes("post"))return r(-1);h.invalidateQueries({queryKey:["posts"]})}else alert("You must be logged in to delete.");f(!1)}async function M(){if(!m)return alert("You must be logged in to save.");v?(await _.delete(`/api/posts/saved/${i==null?void 0:i.id}`),o(!1)):(await _.put(`/api/posts/saved/${i==null?void 0:i.id}`),o(!0)),h.invalidateQueries({queryKey:["saved"]}),f(!1)}function D(){b(!0),l(a.jsx(R,{isEdit:!0,postInfo:i,setShowModal:b,threadInfo:n}))}const P=m&&(e.user_name===d.username||d.roles.includes("admin")||d.roles.includes("mod")&&d.mod_in.includes(n.thread_id));return a.jsx(a.Fragment,{children:a.jsxs("div",{ref:c,className:"flex relative items-center cursor-pointer group",onClick:()=>f(!0),children:[a.jsx(j,{className:"w-4 h-4 md:w-6 md:h-6",type:"more"}),a.jsx("p",{className:"ml-2 text-sm cursor-pointer md:text-base",children:"More"}),u&&a.jsxs("ul",{className:"absolute top-full z-20 p-1 mt-1 space-y-1 w-24 list-none bg-white rounded-md border-2 border-theme-cultured",children:[a.jsx("li",{className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",onClick:M,children:v?"Unsave":"Save"}),P&&a.jsx("li",{className:"p-1 text-sm text-red-500 cursor-pointer md:text-base hover:bg-theme-cultured",onClick:g,children:"Delete"}),e.user_name===d.username&&a.jsx("li",{onClick:D,className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",children:"Edit"}),a.jsx("li",{className:"p-1 text-sm cursor-pointer md:hidden md:text-base hover:bg-theme-cultured",onClick:()=>{N().then(()=>f(!1))},children:"Share"})]})]})})}C.propTypes={url:t.string,initialCount:t.number,intitalVote:t.bool,contentID:t.number,type:t.string};function C({url:e,intitalVote:n,initialCount:x,contentID:i,type:b}){const[l,N]=y.useState(n),[m,d]=y.useState(x),{isAuthenticated:v}=S(),{mutate:o}=L({mutationFn:async({vote:s,method:r,contentID:c})=>{switch(r){case"put":return _.put(`${e}/${c}`,{is_upvote:s}).then(u=>u.data);case"patch":return _.patch(`${e}/${c}`,{is_upvote:s}).then(u=>u.data);case"delete":return _.delete(`${e}/${c}`).then(u=>u.data)}}});function h(s){if(!v)return alert("You must be logged in to vote.");l===null?(o({vote:s,method:"put",contentID:i}),d(r=>r+(s?1:-1))):s===null?(o({vote:s,method:"delete",contentID:i}),d(r=>r-(l?1:-1))):(o({vote:s,method:"patch",contentID:i}),d(r=>r+(s?2:-2))),N(s)}return b==="mobile"?a.jsxs(a.Fragment,{children:[a.jsx(j,{type:"mobileVote",className:"w-5 h-5 md:w-6 md:h-6",defaultStyle:!0,active:l===!0,onClick:()=>h(l?null:!0)}),a.jsx("p",{className:l===!0?"text-theme-red-coral":l===!1?"text-sky-600":"",children:m}),a.jsx(j,{type:"mobileVote",className:"w-5 h-5 rotate-180 md:w-6 md:h-6",defaultStyle:!1,active:l===!1,onClick:()=>h(l===!1?null:!1)})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-5 py-0.5 bg-orange-100 rounded-md",children:a.jsx(j,{type:"down-arrow",defaultStyle:!0,className:"w-10 h-10 rotate-180",onClick:()=>h(l?null:!0),active:l===!0})}),a.jsx("p",{className:"text-lg font-semibold",children:a.jsx("span",{className:l===!0?"text-theme-red-coral":l===!1?"text-sky-600":"",children:m})}),a.jsx("div",{className:"px-5 py-0.5 bg-blue-50 rounded-md group",children:a.jsx(j,{type:"down-arrow",className:"w-10 h-10",defaultStyle:!1,onClick:()=>h(l===!1?null:!1),active:l===!1})})]})}B.propTypes={post:t.object,isExpanded:t.bool,postIndex:t.number,setCommentMode:t.func};function B({post:e,isExpanded:n=!1,postIndex:x,setCommentMode:i}){var u,f;const b=k(),{isAuthenticated:l}=S(),[N,m]=y.useState(!1),[d,v]=y.useState(a.jsx(a.Fragment,{}));function o(){e!=null&&e.post_info.media&&(m(!0),v(a.jsx("img",{className:"object-cover w-11/12 max-h-5/6 md:w-max md:max-h-screen",src:e==null?void 0:e.post_info.media,alt:""})))}function h(){l?i(g=>!g):alert("You must be logged in to reply.")}const s={hidden:{opacity:0,y:100},animate:{opacity:1,y:0},empty:{}};async function r(){return navigator.clipboard.writeText(`${location.host}/post/${e==null?void 0:e.post_info.id}`).then(()=>{alert("Copied Post Link to clipboard")}).catch(g=>alert(g))}const c=new Date(e==null?void 0:e.post_info.created_at);return a.jsxs(a.Fragment,{children:[a.jsxs(V.li,{className:"flex flex-col p-1 pb-3 bg-white rounded-xl border-2 md:pb-0 hover:drop-shadow-md md:flex-row border-theme-gray-blue",variants:s,initial:x<5||n?"hidden":"empty",animate:x<5||n?"animate":"empty",exit:{opacity:0,y:100,transition:{duration:.25}},transition:{duration:.25,delay:x*.25},children:[a.jsxs("div",{className:"flex flex-col flex-1 p-3 space-y-5 w-full md:space-y-0 md:space-x-4 md:flex-row",children:[(e==null?void 0:e.post_info.media)&&a.jsx("img",{onClick:()=>o(),src:e==null?void 0:e.post_info.media,alt:"",className:"object-cover rounded-md duration-500 cursor-pointer md:h-32 md:w-32 hover:scale-110"}),a.jsxs("div",{className:"flex flex-col space-y-1 w-full md:justify-between",children:[n?a.jsxs("div",{className:"flex flex-col space-y-2 w-full h-full",children:[a.jsx("div",{className:"w-full font-semibold md:text-lg text-ellipsis",children:e==null?void 0:e.post_info.title}),n&&a.jsx("p",{className:"text-sm",children:e==null?void 0:e.post_info.content})]}):a.jsxs(w,{to:`/post/${e==null?void 0:e.post_info.id}`,className:"flex flex-col space-y-2 w-full h-full",children:[a.jsx("div",{className:"w-full font-semibold md:text-lg text-ellipsis",children:e==null?void 0:e.post_info.title}),n&&a.jsx("p",{className:"text-sm",children:e==null?void 0:e.post_info.content})]}),a.jsxs("div",{className:"flex justify-between md:space-x-2",children:[a.jsxs("div",{className:"flex space-x-2 w-full md:w-fit",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm",children:[a.jsxs(w,{to:`/u/${e==null?void 0:e.user_info.user_name}`,children:["By"," ",a.jsxs("span",{className:"text-xs font-medium hover:underline hover:text-blue-600 md:text-sm",children:["u/",e==null?void 0:e.user_info.user_name]})]}),a.jsx("img",{src:(e==null?void 0:e.user_info.user_avatar)||Y,alt:"",className:"object-cover w-6 h-6 rounded-full"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-xs md:text-sm",children:"in"}),a.jsx(w,{to:`/${e==null?void 0:e.thread_info.thread_name}`,className:"text-xs font-medium hover:underline hover:text-theme-orange md:text-sm",children:` ${e==null?void 0:e.thread_info.thread_name}`}),(e==null?void 0:e.thread_info.thread_logo)&&a.jsx("img",{src:e==null?void 0:e.thread_info.thread_logo,alt:"",className:"object-cover w-6 h-6 rounded-full"})]}),a.jsx("span",{onClick:()=>b(`/post/${e==null?void 0:e.post_info.id}`),className:"flex-1 md:hidden"})]}),a.jsxs("div",{className:"hidden space-x-1 md:flex",children:[a.jsxs("p",{className:"text-xs font-light",children:[c.toDateString()," ",c.toLocaleTimeString({hour12:!0})]}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]}),a.jsxs("div",{className:"flex space-x-1 md:hidden",children:[a.jsxs("p",{className:"text-xs font-light",children:[c.toDateString()," ",c.toLocaleTimeString({hour12:!0})]}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]})]}),a.jsxs("div",{className:"flex justify-around w-full md:justify-evenly md:px-10 md:flex-col md:w-fit",children:[n?a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(j,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6",onClick:()=>h()}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Reply"})]}):a.jsxs(w,{to:`/post/${e==null?void 0:e.post_info.id}`,className:"flex items-center space-x-2 cursor-pointer group",children:[a.jsx(j,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("span",{className:"text-sm cursor-pointer md:text-base",children:e==null?void 0:e.post_info.comments_count}),a.jsx("p",{className:"hidden md:block",children:"Comments"})]})]}),a.jsxs("div",{className:"hidden items-center space-x-2 cursor-pointer md:flex group",onClick:r,children:[a.jsx(j,{type:"share",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Share"})]}),a.jsx($,{creatorInfo:e==null?void 0:e.user_info,threadInfo:e==null?void 0:e.thread_info,postInfo:e==null?void 0:e.post_info,setShowModal:m,setModalData:v,handleShare:r,currentUser:e==null?void 0:e.current_user}),a.jsx("div",{className:"flex items-center space-x-3 md:hidden",children:a.jsx(C,{intitalVote:(u=e==null?void 0:e.current_user)==null?void 0:u.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"mobile"})})]}),a.jsx("div",{className:"hidden flex-col justify-around items-center my-2 space-y-1 w-28 border-l md:flex border-theme-gray-blue",children:a.jsx(C,{intitalVote:(f=e==null?void 0:e.current_user)==null?void 0:f.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"full"})})]}),n&&a.jsx(q,{}),a.jsx(E,{children:N&&a.jsx(Q,{setShowModal:m,showModal:N,children:d})})]})}export{B as P,C as V};
