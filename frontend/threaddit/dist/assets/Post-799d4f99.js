import{P as i,A as S,r as y,b as P,t as A,u as k,v as T,j as a,S as f,d as N,w as F,h as R,m as E,i as w,c as L,x as V,g as q,M as Q}from"./index-d818f154.js";$.propTypes={creatorInfo:i.object,threadInfo:i.object,postInfo:i.object,setShowModal:i.func,setModalData:i.func,handleShare:i.func};function $({creatorInfo:e,threadInfo:c,postInfo:l,setShowModal:u,setModalData:b,handleShare:t}){const{isAuthenticated:j,user:d}=S(),[x,v]=y.useState(l==null?void 0:l.saved),h=P(),o=A(),s=k(),r=y.useRef(),[m,n]=y.useState(!1);T(r,()=>{n(!1)});async function g(){if(j){if(await N.delete(`/api/post/${l==null?void 0:l.id}`),o.pathname.includes("post"))return s(-1);h.invalidateQueries({queryKey:["posts"]})}else alert("You must be logged in to delete.");n(!1)}async function _(){x?(await N.delete(`/api/posts/saved/${l==null?void 0:l.id}`),v(!1)):(await N.put(`/api/posts/saved/${l==null?void 0:l.id}`),v(!0)),h.invalidateQueries({queryKey:["saved"]}),n(!1)}function M(){u(!0),b(a.jsx(F,{isEdit:!0,postInfo:l,setShowModal:u,threadInfo:c}))}const D=j&&(e.user_name===d.username||d.roles.includes("admin")||d.roles.includes("mod")&&d.mod_in.includes(c.thread_id));return a.jsx(a.Fragment,{children:a.jsxs("div",{ref:r,className:"flex relative items-center cursor-pointer group",onClick:()=>n(!0),children:[a.jsx(f,{className:"w-4 h-4 md:w-6 md:h-6",type:"more"}),a.jsx("p",{className:"ml-2 text-sm cursor-pointer md:text-base",children:"More"}),m&&a.jsxs("ul",{className:"absolute top-full z-20 p-1 mt-1 space-y-1 w-24 list-none bg-white rounded-md border-2 border-theme-cultured",children:[a.jsx("li",{className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",onClick:_,children:x?"Unsave":"Save"}),D&&a.jsx("li",{className:"p-1 text-sm text-red-500 cursor-pointer md:text-base hover:bg-theme-cultured",onClick:g,children:"Delete"}),e.user_name===d.username&&a.jsx("li",{onClick:M,className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",children:"Edit"}),a.jsx("li",{className:"p-1 text-sm cursor-pointer md:hidden md:text-base hover:bg-theme-cultured",onClick:()=>{t().then(()=>n(!1))},children:"Share"})]})]})})}C.propTypes={url:i.string,initialCount:i.number,intitalVote:i.bool,contentID:i.number,type:i.string};function C({url:e,intitalVote:c,initialCount:l,contentID:u,type:b}){const[t,j]=y.useState(c),[d,x]=y.useState(l),{isAuthenticated:v}=S(),{mutate:h}=R({mutationFn:async({vote:s,method:r,contentID:m})=>{switch(r){case"put":return N.put(`${e}/${m}`,{is_upvote:s}).then(n=>n.data);case"patch":return N.patch(`${e}/${m}`,{is_upvote:s}).then(n=>n.data);case"delete":return N.delete(`${e}/${m}`).then(n=>n.data)}}});function o(s){if(!v)return alert("You must be logged in to vote.");t===null?(h({vote:s,method:"put",contentID:u}),x(r=>r+(s?1:-1))):s===null?(h({vote:s,method:"delete",contentID:u}),x(r=>r-(t?1:-1))):(h({vote:s,method:"patch",contentID:u}),x(r=>r+(s?2:-2))),j(s)}return b==="mobile"?a.jsxs(a.Fragment,{children:[a.jsx(f,{type:"mobileVote",className:"w-5 h-5 md:w-6 md:h-6",defaultStyle:!0,active:t===!0,onClick:()=>o(t?null:!0)}),a.jsx("p",{className:t===!0?"text-theme-red-coral":t===!1?"text-sky-600":"",children:d}),a.jsx(f,{type:"mobileVote",className:"w-5 h-5 rotate-180 md:w-6 md:h-6",defaultStyle:!1,active:t===!1,onClick:()=>o(t===!1?null:!1)})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-5 py-0.5 bg-orange-100 rounded-md",children:a.jsx(f,{type:"down-arrow",defaultStyle:!0,className:"w-10 h-10 rotate-180",onClick:()=>o(t?null:!0),active:t===!0})}),a.jsx("p",{className:"text-lg font-semibold",children:a.jsx("span",{className:t===!0?"text-theme-red-coral":t===!1?"text-sky-600":"",children:d})}),a.jsx("div",{className:"px-5 py-0.5 bg-blue-50 rounded-md group",children:a.jsx(f,{type:"down-arrow",className:"w-10 h-10",defaultStyle:!1,onClick:()=>o(t===!1?null:!1),active:t===!1})})]})}Y.propTypes={post:i.object,isExpanded:i.bool,postIndex:i.number,setCommentMode:i.func};function Y({post:e,isExpanded:c=!1,postIndex:l,setCommentMode:u}){var n,g;const b=k(),{isAuthenticated:t}=S(),[j,d]=y.useState(!1),[x,v]=y.useState(a.jsx(a.Fragment,{}));function h(){e!=null&&e.post_info.media&&(d(!0),v(a.jsx("img",{className:"w-11/12 max-h-5/6 md:w-max md:max-h-screen",src:e==null?void 0:e.post_info.media,alt:""})))}function o(){t?u(_=>!_):alert("You must be logged in to reply.")}const s={hidden:{opacity:0,y:100},animate:{opacity:1,y:0},empty:{}};async function r(){return navigator.clipboard.writeText(`${location.host}/post/${e==null?void 0:e.post_info.id}`).then(()=>{alert("Copied Post Link to clipboard")}).catch(_=>alert(_))}const m=new Date(e==null?void 0:e.post_info.created_at);return a.jsxs(a.Fragment,{children:[a.jsxs(E.li,{className:"flex flex-col p-1 pb-3 bg-white rounded-xl border-2 md:pb-0 hover:drop-shadow-md md:flex-row border-theme-gray-blue",variants:s,initial:l<5||c?"hidden":"empty",animate:l<5||c?"animate":"empty",exit:{opacity:0,y:100,transition:{duration:.25}},transition:{duration:.25,delay:l*.25},children:[a.jsxs("div",{className:"flex flex-col flex-1 p-3 space-y-5 w-full md:space-y-0 md:space-x-4 md:flex-row",children:[(e==null?void 0:e.post_info.media)&&a.jsx("img",{onClick:()=>h(),src:e==null?void 0:e.post_info.media,alt:"",className:"rounded-md duration-500 cursor-pointer md:h-32 md:w-32 hover:scale-110"}),a.jsxs("div",{className:"flex flex-col md:justify-between space-y-1 w-full md:cursor-pointer",children:[a.jsxs(w,{to:`/post/${e==null?void 0:e.post_info.id}`,className:"flex flex-col space-y-2 w-full h-full",children:[a.jsx("div",{className:"w-full text-sm font-semibold md:text-lg text-ellipsis",children:e==null?void 0:e.post_info.title}),c&&a.jsx("p",{className:"text-sm",children:e==null?void 0:e.post_info.content})]}),a.jsxs("div",{className:"flex justify-between md:space-x-2",children:[a.jsxs("div",{className:"flex space-x-2 w-full md:w-fit",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm",children:[a.jsxs(w,{to:`/u/${e==null?void 0:e.user_info.user_name}`,children:["By"," ",a.jsxs("span",{className:"hover:underline hover:text-blue-600 font-medium text-xs  md:text-sm",children:["u/",e==null?void 0:e.user_info.user_name]})]}),a.jsx("img",{src:(e==null?void 0:e.user_info.user_avatar)||L,alt:"",className:"w-6 h-6 rounded-full"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-xs md:text-sm",children:"in"}),a.jsx(w,{to:`/${e==null?void 0:e.thread_info.thread_name}`,className:"hover:underline hover:text-theme-orange font-medium text-xs  md:text-sm",children:` ${e==null?void 0:e.thread_info.thread_name}`}),(e==null?void 0:e.thread_info.thread_logo)&&a.jsx("img",{src:e==null?void 0:e.thread_info.thread_logo,alt:"",className:"w-6 h-6 rounded-full"})]}),a.jsx("span",{onClick:()=>b(`/post/${e==null?void 0:e.post_info.id}`),className:"flex-1 md:hidden"})]}),a.jsxs("div",{className:"hidden space-x-1 md:flex",children:[a.jsxs("p",{className:"text-xs font-light",children:[m.toDateString()," ",m.toLocaleTimeString({hour12:!0})]}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]}),a.jsxs("div",{className:"flex space-x-1 md:hidden",children:[a.jsxs("p",{className:"text-xs font-light",children:[m.toDateString()," ",m.toLocaleTimeString({hour12:!0})]}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]})]}),a.jsxs("div",{className:"flex justify-around w-full md:justify-evenly md:px-10 md:flex-col md:w-fit",children:[c?a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(f,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6",onClick:()=>o()}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Reply"})]}):a.jsxs(w,{to:`/post/${e==null?void 0:e.post_info.id}`,className:"flex items-center space-x-2 cursor-pointer group",children:[a.jsx(f,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("span",{className:"text-sm cursor-pointer md:text-base",children:e==null?void 0:e.post_info.comments_count}),a.jsx("p",{className:"hidden md:block",children:"Comments"})]})]}),a.jsxs("div",{className:"hidden items-center space-x-2 cursor-pointer md:flex group",onClick:r,children:[a.jsx(f,{type:"share",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Share"})]}),a.jsx($,{creatorInfo:e==null?void 0:e.user_info,threadInfo:e==null?void 0:e.thread_info,postInfo:e==null?void 0:e.post_info,setShowModal:d,setModalData:v,handleShare:r}),a.jsx("div",{className:"flex items-center space-x-3 md:hidden",children:a.jsx(C,{intitalVote:(n=e==null?void 0:e.current_user)==null?void 0:n.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"mobile"})})]}),a.jsx("div",{className:"hidden flex-col justify-around items-center my-2 space-y-1 w-28 border-l md:flex border-theme-gray-blue",children:a.jsx(C,{intitalVote:(g=e==null?void 0:e.current_user)==null?void 0:g.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"full"})})]}),c&&a.jsx(V,{}),a.jsx(q,{children:j&&a.jsx(Q,{setShowModal:d,showModal:j,children:x})})]})}export{Y as P,C as V};
