import{P as r,b as P,a as $,r as b,d as w,A as q,j as e,m as Q,c as T,g as B,S as N,e as K,L as H}from"./index-730dac88.js";import{u as _,A}from"./index-f95254cf.js";import{V as z,P as G}from"./Post-54fbaa69.js";import{T as J}from"./ThreadsSidebar-ab185c9c.js";Comment.propTypes={children:r.array,comment:r.object};const F=["border-yellow-400","border-blue-400","border-purple-400","border-green-400","border-sky-400","border-pink-400"];let S=0;function O({children:m,comment:n}){const t=P(),{postId:f}=$(),[a,s]=b.useState(m||[]),[{comment_info:c,user_info:h,current_user:i},p]=b.useState(n),{mutate:l}=_({mutationFn:async o=>{o.length!==0&&await w.post("/api/comments",{post_id:f,content:o,has_parent:!0,parent_id:n.comment_info.id},{headers:{"Content-Type":"application/json"}}).then(d=>{s([...a,d.data.new_comment])})}}),{mutate:C}=_({mutationFn:async(o=null)=>{window.confirm("Are you sure you want to delete this comment?")&&w.delete(`/api/comments/${o||c.id}`).then(()=>{o?s(a.filter(d=>d.comment.comment_info.id!==o)):t.setQueryData({queryKey:["post/comment",f]},d=>({...d,comment_info:d.comment_info.filter(v=>v.comment.comment_info.id!==c.id)}))})}}),{mutate:j}=_({mutationFn:async o=>{o.length!==0&&await w.patch(`/api/comments/${c.id}`,{content:o}).then(()=>{p({user_info:h,current_user:i,comment_info:{...c,content:o,is_edited:!0}})})}});function x(){return S==F.length&&(S=0),F[S++]}return{commentChildren:a,commentInfo:c,userInfo:h,currentUser:i,addComment:l,deleteComment:C,updateComment:j,colorSquence:x}}function U(m){const n=Math.floor((new Date-m)/1e3);let t=Math.floor(n/31536e3);return t>1?t+" years ago":(t=Math.floor(n/2592e3),t>1?t+" months ago":(t=Math.floor(n/86400),t>1?t+" days ago":(t=Math.floor(n/3600),t>1?t+" hours ago":(t=Math.floor(n/60),t>1?t+" minutes ago":n<10?"just now":Math.floor(n)+" seconds ago"))))}k.propTypes={children:r.array,comment:r.object,threadID:r.string,commentIndex:r.number,parentDelete:r.func};function k({children:m,comment:n,threadID:t,commentIndex:f,parentDelete:a=null}){const s=b.useRef(null),[c,h]=b.useState(!1),[i,p]=b.useState(!1),[l,C]=b.useState(!1),{commentChildren:j,commentInfo:x,userInfo:o,currentUser:d,addComment:v,deleteComment:M,updateComment:D,colorSquence:I}=O({children:m,comment:n}),{isAuthenticated:E,user:y}=q(),R=U(new Date(x.created_at));function V(u){switch(u){case"delete":a?a(x.id):M(),s.current.value="more";break;case"edit":p(!0);break;case"share":navigator.clipboard.writeText(window.location.href),alert("Post Link Copied to Clipboard"),s.current.value="more";break}}return e.jsxs(Q.div,{className:"py-3 pl-2 space-y-2 w-full bg-white rounded-xl md:text-base",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.25,delay:f*.15},exit:{opacity:0,y:-10,transition:{duration:.15}},children:[i?e.jsx(g,{callBackSubmit:u=>{D(u),p(!1)},callBackCancel:()=>{p(!1),s.current.value="more"},defaultValue:x.content,user:y}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium",children:[e.jsx("img",{src:o.user_avatar||T,alt:"",className:"w-5 h-5 rounded-full"}),e.jsx(B,{to:`/u/${o.user_name}`,children:o.user_name}),e.jsx("p",{children:R}),e.jsx("p",{children:x.is_edited&&"Edited"})]}),e.jsx("p",{className:"mr-2 ml-1 text-sm md:text-base",children:x.content})]}),e.jsxs("div",{className:"flex justify-around items-center md:justify-between md:mx-10",children:[E&&(y.username===o.user_name||y.mod_in.includes(t)||y.roles.includes("admin"))?e.jsxs("select",{defaultValue:"more",ref:s,name:"more-options",id:"more-options",className:"text-sm text-center bg-white md:px-2 md:text-base",onChange:u=>V(u.target.value),children:[e.jsx("option",{value:"more",children:"More"}),e.jsx("option",{value:"share",children:"Share"}),y.username===o.user_name&&e.jsx("option",{value:"edit",children:"Edit"}),e.jsx("option",{value:"delete",children:"Delete"})]}):e.jsxs("div",{className:"flex items-center space-x-1",onClick:()=>null,children:[e.jsx(N,{type:"share",className:"w-4 h-4"}),e.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Share"})]}),e.jsxs("div",{className:"flex items-center space-x-1",onClick:()=>h(!c),children:[e.jsx(N,{type:"comment",className:"w-4 h-4"}),e.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Reply"})]}),e.jsxs("div",{className:`${!j.length&&"invisible"} flex items-center space-x-1`,onClick:()=>C(!l),children:[e.jsx(N,{type:"down-arrow",className:`w-4 h-4 ${l&&"rotate-180"}`}),e.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:l?"Hide":"Show"})]}),e.jsx("div",{className:"flex items-center space-x-2 text-sm md:text-base",children:e.jsx(z,{url:"/api/reactions/comment",intitalVote:d==null?void 0:d.has_upvoted,initialCount:x.comment_karma,contentID:x.id,type:"mobile"})})]}),c&&e.jsx(g,{callBackSubmit:u=>{v(u),h(!1),C(!0)},callBackCancel:()=>h(!1),colorSquence:I,user:y}),l&&e.jsx("ul",{className:j.length>0&&l&&"border-l-2 "+I(),children:e.jsx(A,{children:j.map((u,L)=>e.jsx(k,{...u,commentIndex:L,parentDelete:M},u.comment.comment_info.id))})})]})}g.propTypes={user:r.object,colorSquence:r.func,callBackSubmit:r.func,callBackCancel:r.func,defaultValue:r.string};function g({user:m,colorSquence:n,callBackSubmit:t,callBackCancel:f,defaultValue:a=null}){return e.jsxs("div",{className:`mr-4 space-y-2 bg-white md:text-base ${a!==null?"":`border-l-2 ${n()} py-3 pl-2 `}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium",children:[e.jsx("img",{src:m.avatar||T,alt:"",className:"w-5 h-5 rounded-full"}),e.jsx(B,{to:`/u/${m.username}`,children:m.username})]}),e.jsxs("form",{method:"post",className:"flex flex-col space-y-2",onSubmit:s=>{s.preventDefault(),t(s.target[0].value)},children:[e.jsx("textarea",{autoFocus:!0,defaultValue:a,className:"p-2 w-full text-sm rounded-md border md:text-base focus:outline-none"}),e.jsxs("div",{className:"flex self-end space-x-2",children:[e.jsx("button",{type:"submit",className:"px-2 py-1 font-bold text-white bg-blue-500 rounded-md md:px-5",children:"Submit"}),e.jsx("button",{onClick:()=>f(),className:"px-2 py-1 font-bold text-white bg-red-500 rounded-md md:px-5",children:"Cancel"})]})]})]})}function ee(){const m=P(),{user:n}=q(),{postId:t}=$(),[f,a]=b.useState(!1),{data:s,isFetching:c}=K({queryKey:["post/comment",t],queryFn:async()=>await w.get(`/api/comments/post/${t}`).then(i=>i.data)}),{mutate:h}=_({mutationFn:async i=>{await w.post("/api/comments",{post_id:t,content:i}).then(p=>{m.setQueryData({queryKey:["post/comment",t]},l=>({...l,comment_info:[...l.comment_info,p.data.new_comment]})),a(!1)})}});return c?e.jsx(H,{forPosts:!0}):e.jsxs("div",{className:"flex pb-20 md:pb-0",children:[e.jsx(J,{}),e.jsxs("div",{className:"flex flex-col p-2 space-y-2 w-full",children:[e.jsx(G,{post:s==null?void 0:s.post_info,isExpanded:!0,setCommentMode:a}),f&&e.jsx("div",{className:"py-3 pl-2 space-y-2 w-full bg-white rounded-xl md:text-base",children:e.jsx(g,{user:n,defaultValue:"",callBackSubmit:h,callBackCancel:()=>a(!1)})}),e.jsx(e.Fragment,{children:(s==null?void 0:s.comment_info.length)>0?e.jsx("ul",{className:"space-y-2 rounded-xl md:border-2 md:p-2 hover:shadow-sm border-theme-gray-blue",children:e.jsx(A,{children:s==null?void 0:s.comment_info.map((i,p)=>e.jsx(k,{...i,postId:s==null?void 0:s.post_info.thread_info.thread_id,commentIndex:p},i.comment.comment_info.id))})}):e.jsx("div",{children:e.jsx("p",{className:"p-5 text-sm bg-white rounded-xl border-2 md:text-base hover:shadow-sm border-theme-gray-blue",children:"This post has no comments, be the first to reply!"})})})]})]})}export{ee as FullPost,ee as default};
