import{P as r,A as w,r as y,b as P,q as A,u as D,s as F,j as a,S as j,d as N,t as R,m as T,g as _,c as E,v as V,M as q}from"./index-730dac88.js";import{u as L,A as Q}from"./index-f95254cf.js";C.propTypes={creatorInfo:r.object,threadInfo:r.object,postInfo:r.object,setShowModal:r.func,setModalData:r.func,handleShare:r.func};function C({creatorInfo:e,threadInfo:d,postInfo:l,setShowModal:u,setModalData:b,handleShare:s}){const{isAuthenticated:x,user:c}=w(),[m,v]=y.useState(l==null?void 0:l.saved),h=P(),o=A(),i=D(),n=y.useRef(),[f,t]=y.useState(!1);F(n,()=>{t(!1)});async function S(){if(x){if(await N.delete(`/api/post/${l==null?void 0:l.id}`),o.pathname.includes("post"))return i(-1);h.invalidateQueries({queryKey:["posts"]})}else alert("You must be logged in to delete.");t(!1)}async function k(){m?(await N.delete(`/api/posts/saved/${l==null?void 0:l.id}`),v(!1)):(await N.put(`/api/posts/saved/${l==null?void 0:l.id}`),v(!0)),h.invalidateQueries({queryKey:["saved"]}),t(!1)}function $(){u(!0),b(a.jsx(R,{isEdit:!0,postInfo:l,setShowModal:u,threadInfo:d}))}const M=x&&(e.user_name===c.username||c.roles.includes("admin")||c.roles.includes("mod")&&c.mod_in.includes(d.thread_id));return a.jsx(a.Fragment,{children:a.jsxs("div",{ref:n,className:"flex relative items-center cursor-pointer group",onClick:()=>t(!0),children:[a.jsx(j,{className:"w-4 h-4 md:w-6 md:h-6",type:"more"}),a.jsx("p",{className:"ml-2 text-sm cursor-pointer md:text-base",children:"More"}),f&&a.jsxs("ul",{className:"absolute top-full z-10 p-1 mt-1 space-y-1 w-24 list-none bg-white rounded-md border-2 border-theme-cultured",children:[a.jsx("li",{className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",onClick:k,children:m?"Unsave":"Save"}),M&&a.jsx("li",{className:"p-1 text-sm text-red-500 cursor-pointer md:text-base hover:bg-theme-cultured",onClick:S,children:"Delete"}),e.user_name===c.username&&a.jsx("li",{onClick:$,className:"p-1 text-sm cursor-pointer md:text-base hover:bg-theme-cultured",children:"Edit"}),a.jsx("li",{className:"p-1 text-sm cursor-pointer md:hidden md:text-base hover:bg-theme-cultured",onClick:()=>{s().then(()=>t(!1))},children:"Share"})]})]})})}g.propTypes={url:r.string,initialCount:r.number,intitalVote:r.bool,contentID:r.number,type:r.string};function g({url:e,intitalVote:d,initialCount:l,contentID:u,type:b}){const[s,x]=y.useState(d),[c,m]=y.useState(l),{isAuthenticated:v}=w(),{mutate:h}=L({mutationFn:async({vote:i,method:n,contentID:f})=>{switch(n){case"put":return N.put(`${e}/${f}`,{is_upvote:i}).then(t=>t.data);case"patch":return N.patch(`${e}/${f}`,{is_upvote:i}).then(t=>t.data);case"delete":return N.delete(`${e}/${f}`).then(t=>t.data)}}});function o(i){if(!v)return alert("You must be logged in to vote.");s===null?(h({vote:i,method:"put",contentID:u}),m(n=>n+(i?1:-1))):i===null?(h({vote:i,method:"delete",contentID:u}),m(n=>n-(s?1:-1))):(h({vote:i,method:"patch",contentID:u}),m(n=>n+(i?2:-2))),x(i)}return b==="mobile"?a.jsxs(a.Fragment,{children:[a.jsx(j,{type:"mobileVote",className:"w-5 h-5 md:w-6 md:h-6",defaultStyle:!0,active:s===!0,onClick:()=>o(s?null:!0)}),a.jsx("p",{className:s===!0?"text-theme-red-coral":s===!1?"text-sky-600":"",children:c}),a.jsx(j,{type:"mobileVote",className:"w-5 h-5 rotate-180 md:w-6 md:h-6",defaultStyle:!1,active:s===!1,onClick:()=>o(s===!1?null:!1)})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-5 py-0.5 bg-orange-100 rounded-md",children:a.jsx(j,{type:"down-arrow",defaultStyle:!0,className:"w-10 h-10 rotate-180",onClick:()=>o(s?null:!0),active:s===!0})}),a.jsx("p",{className:"text-lg font-semibold",children:a.jsx("span",{className:s===!0?"text-theme-red-coral":s===!1?"text-sky-600":"",children:c})}),a.jsx("div",{className:"px-5 py-0.5 bg-blue-50 rounded-md group",children:a.jsx(j,{type:"down-arrow",className:"w-10 h-10",defaultStyle:!1,onClick:()=>o(s===!1?null:!1),active:s===!1})})]})}Y.propTypes={post:r.object,isExpanded:r.bool,postIndex:r.number,setCommentMode:r.func};function Y({post:e,isExpanded:d=!1,postIndex:l,setCommentMode:u}){var n,f;const{isAuthenticated:b}=w(),[s,x]=y.useState(!1),[c,m]=y.useState(a.jsx(a.Fragment,{}));function v(){e!=null&&e.post_info.media&&(x(!0),m(a.jsx("img",{className:"w-11/12 max-h-5/6 md:w-max md:max-h-screen",src:e==null?void 0:e.post_info.media,alt:""})))}function h(){b?u(t=>!t):alert("You must be logged in to reply.")}const o={hidden:{opacity:0,y:100},animate:{opacity:1,y:0},empty:{}};async function i(){return navigator.clipboard.writeText(`${location.host}/post/${e==null?void 0:e.post_info.id}`).then(()=>{alert("Copied Post Link to clipboard")}).catch(t=>alert(t))}return a.jsxs(a.Fragment,{children:[a.jsxs(T.div,{className:"flex flex-col p-1 pb-3 bg-white rounded-xl border-2 md:pb-0 hover:drop-shadow-md md:flex-row border-theme-gray-blue",variants:o,initial:l<5||d?"hidden":"empty",animate:l<5||d?"animate":"empty",exit:{opacity:0,y:100,transition:{duration:.25}},transition:{duration:.25,delay:l*.25},children:[a.jsxs("div",{className:"flex flex-col flex-1 p-3 space-y-5 w-full md:space-y-0 md:space-x-4 md:flex-row",children:[(e==null?void 0:e.post_info.media)&&a.jsx("img",{onClick:()=>v(),src:e==null?void 0:e.post_info.media,alt:"",className:"rounded-md duration-500 cursor-pointer md:h-32 md:w-32 hover:scale-110"}),a.jsxs("div",{className:"flex flex-col justify-between space-y-2 w-full cursor-pointer",children:[a.jsxs(_,{className:"flex flex-col space-y-2 w-full h-full",to:`/post/${e==null?void 0:e.post_info.id}`,children:[a.jsx("div",{className:"w-full text-sm font-semibold md:text-lg text-ellipsis",children:e==null?void 0:e.post_info.title}),d&&a.jsx("p",{className:"text-sm",children:e==null?void 0:e.post_info.content})]}),a.jsxs("div",{className:"flex justify-between w-full md:space-x-2",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-xs md:text-sm",children:[a.jsxs(_,{to:`/u/${e==null?void 0:e.user_info.user_name}`,children:["By ",a.jsxs("span",{className:"font-medium",children:["u/",e==null?void 0:e.user_info.user_name]})]}),a.jsx("img",{src:(e==null?void 0:e.user_info.user_avatar)||E,alt:"",className:"w-5 h-5 rounded-full"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-xs md:text-sm",children:"in"}),a.jsx(_,{className:"text-xs font-medium md:text-sm",to:`/${e==null?void 0:e.thread_info.thread_name}`,children:` ${e==null?void 0:e.thread_info.thread_name}`}),(e==null?void 0:e.thread_info.thread_logo)&&a.jsx("img",{src:e==null?void 0:e.thread_info.thread_logo,alt:"",className:"w-5 h-5 rounded-full"})]})]}),a.jsxs("div",{className:"hidden space-x-1 md:flex",children:[a.jsx("p",{className:"text-xs font-light",children:e==null?void 0:e.post_info.created_at}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]}),a.jsxs("div",{className:"flex space-x-1 md:hidden",children:[a.jsx("p",{className:"text-xs font-light",children:e==null?void 0:e.post_info.created_at}),a.jsx("p",{className:"text-xs",children:(e==null?void 0:e.post_info.is_edited)&&"Edited"})]})]})]}),a.jsxs("div",{className:"flex justify-around w-full md:justify-evenly md:px-10 md:flex-col md:w-fit",children:[d?a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(j,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6",onClick:()=>h()}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Reply"})]}):a.jsxs(_,{to:`/post/${e==null?void 0:e.post_info.id}`,className:"flex items-center space-x-2 cursor-pointer group",children:[a.jsx(j,{type:"comment",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("span",{className:"text-sm cursor-pointer md:text-base",children:e==null?void 0:e.post_info.comments_count}),a.jsx("p",{className:"hidden md:block",children:"Comments"})]})]}),a.jsxs("div",{className:"hidden items-center space-x-2 cursor-pointer md:flex group",onClick:i,children:[a.jsx(j,{type:"share",className:"w-4 h-4 md:w-6 md:h-6"}),a.jsx("p",{className:"text-sm cursor-pointer md:text-base",children:"Share"})]}),a.jsx(C,{creatorInfo:e==null?void 0:e.user_info,threadInfo:e==null?void 0:e.thread_info,postInfo:e==null?void 0:e.post_info,setShowModal:x,setModalData:m,handleShare:i}),a.jsx("div",{className:"flex items-center space-x-3 md:hidden",children:a.jsx(g,{intitalVote:(n=e==null?void 0:e.current_user)==null?void 0:n.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"mobile"})})]}),a.jsx("div",{className:"hidden flex-col justify-around items-center my-2 space-y-1 w-28 border-l md:flex border-theme-gray-blue",children:a.jsx(g,{intitalVote:(f=e==null?void 0:e.current_user)==null?void 0:f.has_upvoted,initialCount:e==null?void 0:e.post_info.post_karma,url:"/api/reactions/post",contentID:e==null?void 0:e.post_info.id,type:"full"})})]}),d&&a.jsx(V,{}),a.jsx(Q,{children:s&&a.jsx(q,{setShowModal:x,showModal:s,children:c})})]})}export{Y as P,g as V};
