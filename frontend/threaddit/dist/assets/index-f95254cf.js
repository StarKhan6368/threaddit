import{w as P,x as F,y as U,z as g,B as A,b as B,r as s,C as D,D as K,E as w,F as T,G as q,H as G,I as H}from"./index-730dac88.js";class j extends P{constructor(e,t){super(),this.client=e,this.setOptions(t),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var t;const n=this.options;this.options=this.client.defaultMutationOptions(e),F(n,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(t=this.currentMutation)==null||t.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.currentMutation)==null||e.removeObserver(this)}}onMutationUpdate(e){this.updateResult();const t={listeners:!0};e.type==="success"?t.onSuccess=!0:e.type==="error"&&(t.onError=!0),this.notify(t)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof e<"u"?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const e=this.currentMutation?this.currentMutation.state:U(),t={...e,isLoading:e.status==="loading",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=t}notify(e){g.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(e.onSuccess){var t,n,p,i;(t=(n=this.mutateOptions).onSuccess)==null||t.call(n,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(p=(i=this.mutateOptions).onSettled)==null||p.call(i,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(e.onError){var o,c,h,a;(o=(c=this.mutateOptions).onError)==null||o.call(c,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(h=(a=this.mutateOptions).onSettled)==null||h.call(a,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}e.listeners&&this.listeners.forEach(({listener:u})=>{u(this.currentResult)})})}}function $(r,e,t){const n=A(r,e,t),p=B({context:n.context}),[i]=s.useState(()=>new j(p,n));s.useEffect(()=>{i.setOptions(n)},[i,n]);const o=D(s.useCallback(h=>i.subscribe(g.batchCalls(h)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),c=s.useCallback((h,a)=>{i.mutate(h,a).catch(Q)},[i]);if(o.error&&K(i.options.useErrorBoundary,[o.error]))throw o.error;return{...o,mutate:c,mutateAsync:o.mutate}}function Q(){}function O(){const r=s.useRef(!1);return w(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function V(){const r=O(),[e,t]=s.useState(0),n=s.useCallback(()=>{r.current&&t(e+1)},[e]);return[s.useCallback(()=>T.postRender(n),[n]),e]}class W extends s.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function J({children:r,isPresent:e}){const t=s.useId(),n=s.useRef(null),p=s.useRef({width:0,height:0,top:0,left:0});return s.useInsertionEffect(()=>{const{width:i,height:o,top:c,left:h}=p.current;if(e||!n.current||!i||!o)return;n.current.dataset.motionPopId=t;const a=document.createElement("style");return document.head.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${o}px !important;
            top: ${c}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(a)}},[e]),s.createElement(W,{isPresent:e,childRef:n,sizeRef:p},s.cloneElement(r,{ref:n}))}const y=({children:r,initial:e,isPresent:t,onExitComplete:n,custom:p,presenceAffectsLayout:i,mode:o})=>{const c=q(N),h=s.useId(),a=s.useMemo(()=>({id:h,initial:e,isPresent:t,custom:p,onExitComplete:u=>{c.set(u,!0);for(const f of c.values())if(!f)return;n&&n()},register:u=>(c.set(u,!1),()=>c.delete(u))}),i?void 0:[t]);return s.useMemo(()=>{c.forEach((u,f)=>c.set(f,!1))},[t]),s.useEffect(()=>{!t&&!c.size&&n&&n()},[t]),o==="popLayout"&&(r=s.createElement(J,{isPresent:t},r)),s.createElement(G.Provider,{value:a},r)};function N(){return new Map}function X(r){return s.useEffect(()=>()=>r(),[])}const m=r=>r.key||"";function Y(r,e){r.forEach(t=>{const n=m(t);e.set(n,t)})}function Z(r){const e=[];return s.Children.forEach(r,t=>{s.isValidElement(t)&&e.push(t)}),e}const ee=({children:r,custom:e,initial:t=!0,onExitComplete:n,exitBeforeEnter:p,presenceAffectsLayout:i=!0,mode:o="sync"})=>{const c=s.useContext(H).forceRender||V()[0],h=O(),a=Z(r);let u=a;const f=s.useRef(new Map).current,R=s.useRef(u),C=s.useRef(new Map).current,b=s.useRef(!0);if(w(()=>{b.current=!1,Y(a,C),R.current=u}),X(()=>{b.current=!0,C.clear(),f.clear()}),b.current)return s.createElement(s.Fragment,null,u.map(l=>s.createElement(y,{key:m(l),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:o},l)));u=[...u];const M=R.current.map(m),x=a.map(m),S=M.length;for(let l=0;l<S;l++){const d=M[l];x.indexOf(d)===-1&&!f.has(d)&&f.set(d,void 0)}return o==="wait"&&f.size&&(u=[]),f.forEach((l,d)=>{if(x.indexOf(d)!==-1)return;const v=C.get(d);if(!v)return;const I=M.indexOf(d);let E=l;if(!E){const z=()=>{C.delete(d),f.delete(d);const L=R.current.findIndex(k=>k.key===d);if(R.current.splice(L,1),!f.size){if(R.current=a,h.current===!1)return;c(),n&&n()}};E=s.createElement(y,{key:m(v),isPresent:!1,onExitComplete:z,custom:e,presenceAffectsLayout:i,mode:o},v),f.set(d,E)}u.splice(I,0,E)}),u=u.map(l=>{const d=l.key;return f.has(d)?l:s.createElement(y,{key:m(l),isPresent:!0,presenceAffectsLayout:i,mode:o},l)}),s.createElement(s.Fragment,null,f.size?u:u.map(l=>s.cloneElement(l)))};export{ee as A,$ as u};
